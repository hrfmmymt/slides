<html>
  <head>
    <title>2018/01/26 - PWA ã¨ã¯</title>
    <link rel="stylesheet" href="lib/talkie.min.css">
    <link rel="stylesheet" href="lib/talkie-default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/monokai_sublime.min.css">
    <link rel="stylesheet" href="dist/style.css">
  </head>
  <body>

  <script layout="cover" invert type="text/x-markdown">
  ## PWA ã¨ã¯
  ## 2018/01/26
  </script>

  <script layout="bullets" type="text/x-markdown">

  # Progressive Web Apps

  </script>


  <script layout="bullets" type="text/x-markdown" backface="images/googling.png">
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/firstpwa.png" class="bottom-link" backface-filter="blur(0px) brightness(.9)">

  <small><a href="https://medium.com/@slightlylate/progressive-apps-escaping-tabs-without-losing-our-soul-3b93a8561955">https://medium.com/@slightlylate/progressive-apps-escaping-tabs-without-losing-our-soul-3b93a8561955</a></small>

  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/firstpwa.png" backface-filter="blur(1px) brightness(.1)" class="darkness">

  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
  - ã¨ã‹ï¼ˆå¾Œã§ï¼‰
  ## ã‚’ç·ç§°ã—ãŸã‹ã£ãŸ

  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/pwanow.png" class="bottom-link">
  <small><a href="https://developers.google.com/web/progressive-web-apps/">https://developers.google.com/web/progressive-web-apps/</a></small>
  </script>

  <script layout="bullets" type="text/x-markdown">
  ## æ¦‚è«–
  - Reliable - Load instantly and never show the downasaur, even in uncertain network conditions.
  - ä¿¡é ¼æ€§ - ä¸å®‰å®šãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ã§ã‚ã£ã¦ã‚‚ã€å³åº§ã«ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ€ã‚¦ãƒ³ã‚µã‚¦ãƒ«ã‚¹ã‚’è¡¨ç¤ºã—ãªã„ã
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/downasaur.jpg">
  </script>

  <script layout="bullets" type="text/x-markdown">
  ## æ¦‚è«–
  - Fast - Respond quickly to user interactions with silky smooth animations and no janky scrolling.
  - é€Ÿã„ - ãªã‚ã‚‰ã‹ã§ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¸ãƒ£ãƒ³ã‚¯ã—ãªã„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«ç´ æ—©ãå¯¾å¿œã™ã‚‹ï¼ˆè§£é‡ˆãƒ ã‚ºã„)
  </script>

  <script layout="bullets" type="text/x-markdown">
  ## æ¦‚è«–
  - Engaging - Feel like a natural app on the device, with an immersive user experience.
  - é­…åŠ›çš„ - æ²¡å…¥å‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å‚™ãˆãŸã€ãƒ‡ãƒã‚¤ã‚¹ä¸Šã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã®ã‚ˆã†ãªæ„Ÿè¦š
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Site is served over HTTPS
  - ã‚µã‚¤ãƒˆãŒ HTTPS ã§é…ä¿¡ã•ã‚Œã‚‹ã“ã¨
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Pages are responsive on tablets & mobile devices
  - RWDï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼‰
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - All app URLs load while offline
  - å…¨ã¦ã® URL ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Metadata provided for Add to Home screen
  - "Add to Home screen" ã§ãã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - First load fast even on 3G
  - åˆå›ãƒ­ãƒ¼ãƒ‰ãŒ 3G å›ç·šã§ã‚‚é«˜é€Ÿã§ã‚ã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Site works cross-browser
  - ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œã™ã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Page transitions don't feel like they block on the network
  - ãƒšãƒ¼ã‚¸é·ç§»ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã¯æ„Ÿã˜ã•ã›ãªã„  
  ( ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…ã£ã¦ã‚‹é–“ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã¨ã‹å‡ºã—ã¨ã‘ã£ã¦ã“ã¨ã‚‰ã—ã„ )
  ( SPA? )
  </script>

  <script layout="bullets" type="text/x-markdown">
  ### [Progressive Web App Checklist](https://developers.google.com/web/progressive-web-apps/checklist)
  #### Baseline Progressive Web App Checklist
  - Each page has a URL
  - å„ãƒšãƒ¼ã‚¸ã«ã¯URLãŒã‚ã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/lighthouse.png">
  # [Lighthouse](https://developers.google.com/web/tools/lighthouse/?hl=ja)
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/chromelighthouse.png" class="bottom-link">
  <small><a href="https://r.nikkei.com/">https://r.nikkei.com/</a></small>
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/suumo.png" class="bottom-link">
  <small><a href="https://smp.suumo.jp/">https://smp.suumo.jp/</a></small>
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/najimu.jpg" backface-filter="blur(7px) brightness(1)">
  - ğŸ™†â€æ®µéšï¼ˆéƒ¨åˆ†ï¼‰çš„ã«å°å…¥ã§ãã‚‹
    - Lighthouse 100ç‚¹ã§ãªãã¦ã‚‚ã„ã„
    - 100ç‚¹ã®é”æˆãŒãã®ã‚¢ãƒ—ãƒªã®ã‚´ãƒ¼ãƒ«ã¨ã„ã†ã‚ã‘ã§ã‚‚ãªã„
  - ğŸ™†â€æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚å°å…¥ã§ãã‚‹
  </script>

  <script layout="bullets" type="text/x-markdown">
  # WebAppManifest
  ## manifest.json
  - Add to homescreen
    - -icon
  - Splash screen
  - theme-color ( `<meta>` )
  - Full screen ( "display": "standalone || browser" )
  - "orientation": "portrait || landscape"
  </script>

  <script layout="code" type="text/x-markdown" class="manifest">
  ```manifest.json
  {
    "lang": "ja",
    "name": "SUUMO",
    "short_name": "SUUMO",
    "icons": [{
      "src": "/launcher-icon-3x.png",
      "sizes": "144x144",
      "type": "image/png"
    }, {
      "src": "/splashscreen-icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    }, {
      "src": "/splashscreen-icon-256x256.png",
      "sizes": "256x256",
      "type": "image/png"
    }, {
      "src": "/splashscreen-icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png"
    }, {
      "src": "/splashscreen-icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }],
    "background_color": "#ffffff",
    "theme_color": "#ffffff",
    "start_url": "/apps/homescreen/",
    "display": "standalone",
    "gcm_sender_id": "926788163944"
  }
  ```
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/manifest.png" class="bottom-link">
  </script>

  <script layout="bullets" type="text/x-markdown">
  # Service Worker
  - Cache API
  - ( Push Notification )
  </script>

  <script layout="cover" type="text/x-markdown" backface="images/worker.png" invert backface-filter="blur(0px) brightness(.6)">
  # ğŸ‘€
  </script>

  <script layout="bullets" type="text/x-markdown">
  # Web Worker
  ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ã JS
  </script>

  <script layout="bullets" type="text/x-markdown">
  # Service Worker
  ### ãƒ–ãƒ©ã‚¦ã‚¶ã®è¡¨ç¤ºã¨ã¯åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ã JS Worker
  - ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
  - DOM API æ“ä½œä¸å¯
  - Web æ¨™æº–æŠ€è¡“
  </script>

  <script layout="bullets" type="text/x-markdown" backface="images/caniuse.png">
  # ğŸ‘€
  </script>

  <script layout="code" type="text/x-markdown">
  ```javascript
  // https://example.com/script/main.js
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js', {
      scope: '/'
    }).then(function(registration) {
      // ç™»éŒ²æˆåŠŸ
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }).catch(function(err) {
      // ç™»éŒ²å¤±æ•— :(
      console.log('ServiceWorker registration failed: ', err);
    });
  }
  ```
  â€»Service Worker ã¯ HTTPS ã‹ localhost ã§ã®ã¿å‹•ä½œ
  </script>

  <script layout="code" type="text/x-markdown">
  [Service Worker ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=ja)
  ```javascript
  const CACHE_NAME = 'my-site-cache-v1';
  const urlsToCache = [
    '/',
    '/styles/main.css',
    '/script/main.js'
  ];

  self.addEventListener('install', function(event) {
    // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†
    event.waitUntil(
      caches.open(CACHE_NAME)
        .then(function(cache) {
          console.log('Opened cache');
          return cache.addAll(urlsToCache);
        })
    );
  });
  ```
  </script>

  <script layout="code" type="text/x-markdown">
  [Service Worker ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=ja)
  ```javascript
  self.addEventListener('fetch', function(event) {
    event.respondWith(
      caches.open(CACHE_NAME).then(function(cache) {
        return cache.match(event.request).then(function(response) {
          const fetchPromise = fetch(event.request).then(function(networkResponse) {
            cache.put(event.request, networkResponse.clone());
            return networkResponse;
          });
          return response || fetchPromise;
        });
      });
    );
  });
  ```
  </script>

  <script layout="bullets" type="text/x-markdown" class="cycle">
  <img src="https://camo.qiitausercontent.com/91424b3a365de2e3221f7e399dbe3ff019a31b23/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f35343835302f33643939386137612d643063312d626338372d636332372d3634356336643932643334622e706e67">

  [https://qiita.com/y_fujieda/items/f9e765ac9d89ba241154](https://qiita.com/y_fujieda/items/f9e765ac9d89ba241154)
  # ğŸ™
  </script>

  <script layout="code" type="text/x-markdown">
  â€»ã©ã“ã§è¨€ã†ã‹è¿·ã£ãŸã®ã§è¬ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ãªã£ãŸã‘ã©ã€å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ / CDN ã«ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥æŒ‡å®šã§ãã‚‹ã‚ˆ
  </script>

  <script layout="bullets" type="text/x-markdown" class="cycle">
  <a href="https://developers.google.com/web/tools/workbox/"><img src="https://developers.google.com/web/tools/workbox/thumb.png"></a>
  </script>

  <script layout="code" type="text/x-markdown">
  sw.js
  ```javascript
  importScripts('/node_modules/workbox-sw/build/workbox-sw.vX.X.X.prod.js');

  const workboxSW = new WorkboxSW();
  workboxSW.precache([
    {
      url: '/index.html',
      revision: 'bb121c',
    }, {
      url: '/styles/main.css',
      revision: 'acd123',
    }, {
      url: '/scripts/main.js',
      revision: 'a32caa',
    }
  ]);
  ```
  </script>

  <script layout="code" type="text/x-markdown">
  webpack.config.js
  ```javascript
  new WorkboxBuildWebpackPlugin({
    globDirectory: 'dist/public',
    globPatterns: ['*.{html,js,css}', 'images/**/*.{jpg,jpeg,png,gif,webp,svg}'],
    globIgnores: ['sw.js'],
    swSrc:'src/sw.js',
    swDest: 'dist/sw.js',
    templatedUrls: {
      '/app-shell': ['../views/index.hbs']
    }
  });
  ```
  [https://havelog.ayumusato.com/develop/pwa/e742-appshell_practice_with_webpack_and_workbox.html](https://havelog.ayumusato.com/develop/pwa/e742-appshell_practice_with_webpack_and_workbox.html)
  # ğŸ™
  </script>

  <script layout="cover" type="text/x-markdown">
  <img src="https://developers.google.com/web/fundamentals/architecture/images/appshell.png?hl=ja">
  </script>

  <script layout="bullets" type="text/x-markdown">
  # [App Shell ãƒ¢ãƒ‡ãƒ«](https://developers.google.com/web/fundamentals/architecture/app-shell?hl=ja)
  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å°é™ã® HTMLã€CSSã€JavaScript (App Shell) ã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠãã“ã¨

  - App Shell
    - UI ã®éª¨çµ„ã¿
    - ã‚¢ãƒ—ãƒªã®èµ·å‹•ã«å¿…è¦ãªä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    - å¤šãã®å ´åˆãƒ‡ãƒ¼ã‚¿ã¯å«ã¾ã‚Œãªã„
  </script>

  <script layout="code" type="text/x-markdown">
  ```jsx
  import React from 'react';
  import { renderToString } from 'react-dom/server';
  import { Provider } from 'react-redux';
  import escape from 'escape-html';
  import serialize from 'serialize-javascript';
  import App from '../containers/App';
  import configureStore from '../store/configureStore';

  const render = (state, metas) => {
    const store = configureStore(preloadedState);
    const root = renderToString(
      <Provider store={store}>
        <App />
      </Provider>,
    );
    return `<!doctype html>
      <html>
        <head>
          <title>${escape(metas.title)}</title>
        </head>
        <body>
          <div id="root">${root}</div>
          < script>
            window.__PRELOADED_STATE__ = ${serialize(state)}
          </ script>
          < script src="/build/index.bundle.js"></ script>
        </body>
      </html>
  `;
  };
  export default render;
  ```
  </script>

  <script layout="bullets" type="text/x-markdown">
  # Push Notification
  </script>

  <script layout="bullets" invert type="text/x-markdown">

  # ãŠã—ã¾ã„

  ### ã”é™è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ

  </script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
  <script src="lib/talkie.min.js"></script>
  <script>
  Talkie();

  // ãƒªãƒ³ã‚¯ã¯åˆ¥ã‚¿ãƒ–
  var i, links = document.querySelectorAll("a[href^='http']")
  for(i=0; i<links.length; i++) {
    links[i].setAttribute('target', '_blank');
  }
  </script>
  </body>
</html>